<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>アンケート</title>
    <style>
        #font-size-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1001;
        }
        .font-size-btn {
            padding: 5px 10px;
            margin-left: 5px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 3px;
            background-color: white; /* 通常のボタンの背景色 */
        }
        .font-size-btn.active {
            background-color: #333; /* 選択中ボタンの背景色 */
            color: white;           /* 選択中ボタンの文字色 */
        }
        .question-block {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        textarea {
            width: 90%;
            padding: 8px;
            margin-top: 5px;
        }
        .admin-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            text-decoration: none;
            z-index: 1000;
        }
        .post_button {
            padding: 10px 20px;
            font-size: 16px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .post_button:hover {
            background-color: #9BD4B5;
            transform: scale(1.05);
        }
         footer {
            background-color: #f0f0f0;
            padding: 50px;
            text-align: center;
            margin-top: 50px;
         }
    </style>
</head>
<body>
    <div id="font-size-controls">
        <button class="font-size-btn active" data-size="100%">標準</button>
        <button class="font-size-btn" data-size="125%">大</button>
        <button class="font-size-btn" data-size="150%">特大</button>
    </div>

    <h1>アンケートフォーム</h1>
    <p>近年、COVID-19をきっかけとして「一人で練習できる」という観点からVRを用いた体験型医療教育への関心が高まってきている。一方、現在VRを用いた心肺蘇生法（CPR）に関する研究や商品はいくつか存在するが、高価な医療器具や人体モデルを使用するなど、価格や場所の確保に関して課題がある。医療教育現場においても公平かつ定量的な評価システムが必要とされており、現在AEDを組み込んだCPR訓練システムの開発が必要とされている。
        <br><br>以下の質問にご回答ください。</p>

    <form method="post">
        {% csrf_token %}

        {% for question in questions %}
        <div class="question-block"
             id="question-{{ question.id }}"
             {% if question.parent_question and question.trigger_choice %}
                 data-parent-id="{{ question.parent_question.id }}"
                 data-trigger-choice-id="{{ question.trigger_choice.id }}"
                 style="display:none;"
             {% endif %}>

            {% if question.image %}
                <img src="{{ question.image.url }}" alt="{{ question.text }}" style="max-width: 400px; height: auto;">
            {% endif %}

            <p><strong>{{ forloop.counter }}. {{ question.text }}</strong></p>

            {% if question.question_type == 'CHOICE' %}
                {% for choice in question.choices.all %}
                <label>
                    <input type="radio" name="answer_for_question_{{ question.id }}" value="{{ choice.id }}" {% if not question.parent_question %}required{% endif %}>
                    {{ choice.text }}
                </label>
                <br>
                {% endfor %}

            {% elif question.question_type == 'TEXT' %}
                <textarea name="answer_for_question_{{ question.id }}" rows="3" {% if not question.parent_question %}required{% endif %}></textarea>
            {% endif %}
        </div>
        {% endfor %}

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fontButtons = document.querySelectorAll('.font-size-btn');
            const contentBody = document.body;

            fontButtons.forEach(button => {
                button.addEventListener('click', function() {
                    fontButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const newSize = this.dataset.size;
                    contentBody.style.fontSize = newSize;
                });
            });

            const allRadios = document.querySelectorAll('input[type="radio"]');
        
            allRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const parentQuestionDiv = this.closest('.question-block');
                    const parentQuestionId = parentQuestionDiv.id.split('-')[1];
                    const selectedChoiceId = this.value;
        
                    const allQuestions = document.querySelectorAll('.question-block');
                    allQuestions.forEach(questionDiv => {
                        const requiredParentId = questionDiv.dataset.parentId;
                        const requiredTriggerId = questionDiv.dataset.triggerChoiceId;
        
                        if (requiredParentId === parentQuestionId) {
                            const inputs = questionDiv.querySelectorAll('input, textarea');

                            if (requiredTriggerId === selectedChoiceId) {
                                questionDiv.style.display = 'block';
                                inputs.forEach(input => input.required = true);
                            } else {
                                questionDiv.style.display = 'none';
                                inputs.forEach(input => input.required = false);
                            }
                        }
                    });
                });
            });
        });
        </script>

        <a href="{% url 'admin:index' %}" class="admin-link">管理者ページへ</a>
        
        <button type="submit" class="post_button">送信する</button>
    </form>
</body>
</html>